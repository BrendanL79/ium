<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Update Manager</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Image Update Manager</h1>
            <div class="status-bar">
                <span id="status-indicator" class="status-dot"></span>
                <span id="status-text">Disconnected</span>
                <span id="mode-indicator" class="mode"></span>
                <span class="daemon-status">
                    <span id="daemon-indicator" class="status-dot"></span>
                    <span id="daemon-status-text">Daemon: Stopped</span>
                </span>
                <span id="last-check"></span>
                <button id="theme-toggle" class="btn-icon btn-theme-toggle" title="Toggle dark/light mode" aria-label="Toggle theme">&#9681;</button>
            </div>
        </header>

        <div class="controls">
            <button id="check-now" class="btn btn-primary">Check Now</button>
            <button id="toggle-daemon" class="btn btn-secondary">Start Daemon</button>
            <label class="daemon-interval">
                Interval (seconds):
                <input type="number" id="daemon-interval" value="3600" min="60">
            </label>
        </div>

        <div class="tabs">
            <button class="tab-button active" data-tab="updates">Updates</button>
            <button class="tab-button" data-tab="config">Configuration</button>
            <button class="tab-button" data-tab="history">History</button>
            <button class="tab-button" data-tab="log">Log <span id="log-badge" class="tab-badge" style="display:none"></span></button>
        </div>

        <div class="tab-content">
            <div id="updates" class="tab-pane active">
                <h2>Available Updates</h2>
                <div id="update-list" class="update-list">
                    <p class="no-updates">No updates checked yet.</p>
                </div>
            </div>

            <div id="config" class="tab-pane">
                <div id="unsaved-banner" class="unsaved-banner" style="display:none">
                    You have unsaved changes &mdash;
                    <button class="btn btn-sm btn-primary" onclick="saveConfig()">Save Now</button>
                </div>
                <h2>Configuration</h2>
                <div id="config-editor">
                    <div class="config-toolbar">
                        <button id="add-image" class="btn btn-primary">+ Add Image</button>
                        <button id="add-preset" class="btn btn-secondary">Add from Preset</button>
                        <button id="save-config" class="btn btn-success">Save Configuration</button>
                    </div>
                    <div id="image-cards" class="image-cards-container">
                        <!-- Cards dynamically inserted by JavaScript -->
                    </div>

                    <div id="notifications-section" class="notifications-section">
                        <h3 class="notifications-heading">Notifications</h3>

                        <div class="notification-block">
                            <h4>ntfy.sh</h4>
                            <div class="form-group">
                                <label>Topic URL</label>
                                <input type="text" id="ntfy-url" class="form-input"
                                       placeholder="https://ntfy.sh/my-topic">
                            </div>
                            <div class="form-group">
                                <label>Priority</label>
                                <select id="ntfy-priority" class="form-input">
                                    <option value="min">min</option>
                                    <option value="low">low</option>
                                    <option value="default" selected>default</option>
                                    <option value="high">high</option>
                                    <option value="urgent">urgent</option>
                                </select>
                            </div>
                            <div class="notification-actions">
                                <button id="test-ntfy" class="btn btn-secondary btn-sm">Test</button>
                                <span id="ntfy-test-status" class="detect-status"></span>
                            </div>
                        </div>

                        <div class="notification-block">
                            <h4>Webhook</h4>
                            <div class="form-group">
                                <label>URL</label>
                                <input type="text" id="webhook-url" class="form-input"
                                       placeholder="https://hooks.example.com/...">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Method</label>
                                    <select id="webhook-method" class="form-input">
                                        <option value="POST" selected>POST</option>
                                        <option value="PUT">PUT</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Body Template <span class="field-hint">(optional)</span></label>
                                <textarea id="webhook-body-template" class="form-input" rows="3"
                                          placeholder='{"content": "Update: $image \u2192 $new_version"}'></textarea>
                                <span class="field-hint">Variables: $image, $old_version, $new_version, $event, $digest, $auto_update. Leave blank to send the raw JSON payload.</span>
                            </div>
                            <div class="notification-actions">
                                <button id="test-webhook" class="btn btn-secondary btn-sm">Test</button>
                                <span id="webhook-test-status" class="detect-status"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="history" class="tab-pane">
                <h2>Update History</h2>
                <div id="history-list" class="history-list">
                    <p>Loading history...</p>
                </div>
            </div>

            <div id="log" class="tab-pane">
                <h2>Activity Log</h2>
                <div id="log-output" class="log-output" style="height: 400px;"></div>
            </div>
        </div>

        <footer class="app-footer">
            <span id="app-version">ium</span>
        </footer>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>